# 서울시 OpenAPI 분석 문서

## 개요

이 문서는 서울시 열린데이터광장 OpenAPI의 구조와 특성, 그리고 실제 사용 시 제약사항을 정리합니다.

---

## 1. API 카탈로그

### 전체 통계
- **총 API 서비스 수**: 8,212개
- **수집 방법**: Python 크롤러를 사용해 SearchCatalogService API로 전체 카탈로그 수집
- **저장 위치**: `public/data/seoul-api-catalog.json`

### API 분류

#### 서비스 타입별 분류
- **Sheet**: 엑셀 파일 다운로드용 (대다수)
- **Api**: 실시간 API 호출 가능 (소수)
- **Sheet,Api**: 두 가지 모두 지원 (일부)

#### 지역별 분류
- **서울시(본청)**: 서울시 전체 데이터
- **자치구 및 자치구산하**: 25개 구별 개별 데이터 (약 4,429개)

---

## 2. 구별 API 분석

### 2.1 구별 API 현황

```bash
node analyze-gu-apis.js
```

#### 분석 결과
- **총 구별 API 수**: 4,429개
- **25개 구 모두 존재하는 완전한 API 타입**: 120개
  - 예: 사회복지시설 목록, 일반음식점 인허가 정보, 휴게음식점 인허가 정보 등
- **일부 구에만 존재하는 API 타입**: 수백 개

#### 구별 API 명명 규칙
- 패턴: `서울시 [구이름] [API 타입]`
- 예시:
  - `서울시 강남구 일반음식점 인허가 정보`
  - `서울시 강동구 일반음식점 인허가 정보`
  - `서울시 강북구 일반음식점 인허가 정보`
  - ... (25개 구 모두)

### 2.2 구별 API의 심각한 제약사항 ⚠️

**핵심 문제: 구별 API는 실시간 호출이 불가능합니다.**

#### 테스트 결과

모든 구별 API에 대해 `tbLnOpendataService` 엔드포인트로 호출 시:

```bash
# 테스트 예시
curl "http://openapi.seoul.go.kr:8088/{API_KEY}/json/tbLnOpendataService/1/10/OA-20399/"
```

**응답**:
```json
{
  "RESULT": {
    "CODE": "ERROR-500",
    "MESSAGE": "서버 오류입니다.\n지속적으로 발생시 열린 데이터 광장으로 문의(Q&A) 바랍니다."
  }
}
```

또는

```json
{
  "tbLnOpendataService": {
    "RESULT": {
      "CODE": "INFO-200",
      "MESSAGE": "해당하는 데이터가 없습니다."
    }
  }
}
```

#### 테스트한 API 목록
- 사회복지시설 목록 (OA-20399 등)
- 일반음식점 인허가 정보 (OA-18674 등)
- 휴게음식점 인허가 정보
- 의원 인허가 정보 (OA-16236 등)
- 동물병원 인허가 정보
- 제과점영업 인허가 정보
- 안전상비의약품 판매업소 인허가 정보

**결과**: 120개의 "완전한 API 타입" 중 **실시간으로 데이터를 가져올 수 있는 것은 0개**

#### 원인 분석

1. **API 타입의 혼동**
   - 카탈로그에는 `serviceType: "Sheet,Api"` 또는 `"Api"`로 표시
   - 실제로는 엑셀 다운로드용 "Sheet" 데이터만 제공
   - 실시간 API 엔드포인트는 존재하지 않거나 작동하지 않음

2. **서울시 OpenAPI 구조**
   - 대부분의 구별 데이터는 **파일 다운로드용**으로만 제공
   - `tbLnOpendataService`는 일부 특정 서비스에만 작동
   - 구별 상세 데이터는 API가 아닌 엑셀 파일로 배포

3. **서버 응답**
   - ERROR-500: 서버 내부 오류 (실제로는 해당 서비스가 API로 제공되지 않음)
   - INFO-200: 데이터 없음 (API 엔드포인트는 있지만 데이터가 비어있음)

---

## 3. 실제로 작동하는 API

### 3.1 검증된 실시간 API

다음 5개의 API는 실제로 실시간 데이터 조회가 가능합니다:

| ID | 서비스명 | 설명 | 공간정보 |
|---|---|---|---|
| WORKING-001 | RealtimeCityAir | 서울시 권역별 실시간 대기환경 정보 | 없음 |
| WORKING-002 | bikeList | 서울시 공공자전거(따릉이) 대여소 정보 | Point (위도/경도) |
| WORKING-003 | SearchPublicToiletPOIService | 서울시 공중화장실 정보 | Point |
| WORKING-004 | GetParkInfo | 서울시 공원 정보 | Point |
| WORKING-005 | culturalEventInfo | 서울시 문화행사 정보 | 없음 |

### 3.2 API 호출 방법

**Known API 호출**:
```
http://openapi.seoul.go.kr:8088/{API_KEY}/json/{serviceName}/{startIndex}/{endIndex}/
```

예시:
```bash
# 따릉이 대여소 정보
curl "http://openapi.seoul.go.kr:8088/{API_KEY}/json/bikeList/1/100/"

# 실시간 대기질 정보
curl "http://openapi.seoul.go.kr:8088/{API_KEY}/json/RealtimeCityAir/1/25/"
```

---

## 4. 구별 통합 데이터 시각화의 한계

### 4.1 원래 계획

1. 120개의 완전한 API 타입 (모든 구 커버) 중 하나 선택
2. 25개 구의 API를 병렬로 호출
3. 데이터를 병합해서 서울시 전체 데이터로 통합
4. 구 경계 지도에 시각화

### 4.2 실제 결과

- **성공한 구**: 0/25
- **실패한 구**: 25/25
- **실패 원인**: "데이터 없음" (ERROR-500 또는 INFO-200)

### 4.3 구현 상태

- ✅ `/gu-data` 페이지 UI 완성
- ✅ `/api/aggregate-gu-data` API 엔드포인트 완성
- ✅ 25개 구 병렬 데이터 수집 로직 완성
- ❌ **실제 데이터 수집 불가** (서울시 API 제약)

**결론**: 구별 통합 데이터 시각화는 현재 서울시 OpenAPI 구조상 불가능합니다.

---

## 5. 대안

### 5.1 엑셀 파일 직접 다운로드

- 서울시 열린데이터광장에서 엑셀 파일 수동 다운로드
- CSV로 변환 후 `public/data/` 폴더에 저장
- 정적 데이터로 시각화

**장점**: 구별 상세 데이터 확보 가능
**단점**: 실시간 업데이트 불가, 수동 작업 필요

### 5.2 실시간 API만 사용

- 5개의 검증된 실시간 API만 활용
- 따릉이, 대기질, 공원, 화장실, 문화행사 데이터 시각화
- 구별 통합 기능 대신 서울시 전체 POI 시각화

**장점**: 실시간 데이터 활용 가능
**단점**: 제한적인 데이터 종류

### 5.3 서울시 전체 데이터 사용

- 구별 데이터 대신 서울시 본청 API 활용
- 25개 구로 나누지 않고 서울시 단위로 집계
- 행정동/구 단위 분석은 클라이언트 사이드에서 처리

---

## 6. 참고 파일

### 분석 스크립트
- `analyze-gu-apis.js` - 구별 API 패턴 분석
- `create-gu-dissolved.js` - Turf.js로 구 경계 생성

### 생성된 데이터
- `public/data/gu-api-analysis.json` - 120개 완전한 API 타입 목록
- `public/data/seoul-gu.geojson` - 25개 구 경계 GeoJSON

### API 엔드포인트
- `/api/aggregate-gu-data` - 구별 데이터 병합 API (현재 작동 불가)
- `/api/seoul-data` - 일반 서울시 API 프록시

### UI 페이지
- `/gu-map` - 구 경계 지도 뷰어
- `/gu-data` - 구별 통합 데이터 시각화 (보류)

---

## 7. 결론 및 권장사항

### 현재 상황
- 서울시 OpenAPI는 **실시간 API 호출이 가능한 서비스가 매우 제한적**
- 대부분의 상세 데이터는 **파일 다운로드 방식**으로만 제공
- 구별 API는 카탈로그에는 등록되어 있지만 **실제 API 호출 불가**

### 권장사항
1. **검증된 5개 실시간 API** 중심으로 개발
2. 상세한 구별 데이터가 필요한 경우 **엑셀 파일 다운로드 후 정적 데이터로 활용**
3. `/gu-data` 페이지는 **보류** 또는 다른 데이터 소스로 전환

### 향후 개선 방안
- 서울시 열린데이터광장에 API 개선 건의
- 다른 공공데이터 포털 탐색 (공공데이터포털, 국토부 등)
- 정적 데이터와 실시간 API를 혼합한 하이브리드 방식 고려

---

**작성일**: 2026-01-08
**작성자**: Claude Code + 사용자
**프로젝트**: 서울시 행정동 인터랙티브 지도
